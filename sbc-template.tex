\documentclass[12pt]{article}

\usepackage{cmap}
\usepackage{sbc-template}
\usepackage{listings}
\usepackage{graphicx,url}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb}

\usepackage[brazil]{babel}
\usepackage[utf8]{inputenc}

\title{Protocolo Sistema Simples de Notificação Remota}

\author{
	Jonathas Augusto de Oliveira Conceição\inst{1}
}

\address{
	Curso de Bacharelado em Ciêncai da Computação\\
	Universidade Federal de Pelotas (UFPel)
	\email{jadoliveira@inf.ufpel.edu.br}
}

\begin{document}

\maketitle

\begin{resumo}
	O Sistema Simples de Notificação Remota é um protocolo de notificações distribuída em modelo cliente-servidor.
	Nele há dois tipos de possíveis clientes, emissores e receptores de notificações.
	No sistema os clientes se comunicam por meio de um servidor que contem a identificação de casa receptor e,
	sempre que recebe uma notificação,
	a encaminha ao destinatário correspondente.
	Um cliente pode ser apenas emissor ou apenas receptor, simplificando assim a implementação do protocolo em um dispositivo.
\end{resumo}

%%=========================================================================================
\section{Introdução}
%%=========================================================================================

O Sistema Simples de Notificação Remota
é um protocolo de notificações distribuída em modelo cliente-servidor.
No sistema a comunicação é feita por meio de um servidor que contem a identificação de receptores,
e quando requisitado, repassa a notificação ao destinatário correspondente.

O protocolo define dois tipos de clientes, emissores e receptores de notificações.
Receptores podem se conectar à um servidor enviando uma mensagem de conexão junto à um nome de identificação.
Uma vez conetados eles passam a receber notificações de qualquer remetente com acesso aquele servidor que deseje contactá-los.
Emissores podem enviar mensagens ao servidor requisitando uma lista de clientes conectados,
e podem também enviar notificações à clientes conectados ao servidor.

O servidor então tem três funcionalidades principais:
(1) indexar receptores conectados;
(2) enviar lista dos receptores disponíveis à emissores;
(3) receber e entregar notificações vinda de um emissor para um receptor válido.

O artigo é organizado da seguinte forma:
A Seção \ref{sec:MaquinaDeEstados} apresenta as máquinas de estados do cliente emissor, cliente receptor e do servidor;
na Seção \ref{sec:Mensagens} todos os tipos de mensagens e seus cabeçalhos são apresentados;
por fim, a Seção \ref{sec:Conclusao} conclui apresentado um caso de uso do protocolo.

%%=========================================================================================
\section{Máquina de Estados}\label{sec:MaquinaDeEstados}
%%=========================================================================================

A seguir são apresentados as máquinas de estado para o
Cliente Emissor,
o Cliente Receptor e
o Servidor.
Os círculos representam estados do sistema e
as transações são dadas por dois componentes:
um evento que pode acontecer;
e uma ação a ser tomada.
Os componentes da transição são separados por um traço vertical,
o evento sempre se encontra acima do traço e
a ação a ser tomada se encontra abaixo.

O Cliente Emissor funciona através de trocas de mensagens com uma conexão que não fica constantemente aberta com o servidor.
Ele pode solicitar a lista atual de usuários conectados ou enviar uma mensagem para um usuário.
A Figura \ref{fig:Emissor} apresenta a máquina de estados do cliente emissor.

O receptor, por sua vez, tenta se conectar à um servidor e,
se bem sucedido,
fica à escuta de notificações.
Sua máquina de estados é apresentada na Figura \ref{fig:Receptor}.

O servidor, uma vez iniciado,
aloca uma tabela para indexar os receptores e fica à espera de mensagens.
Caso receba uma mensagem de notificação ele encontra o receptor na tabela a encaminha;
ele também deve enviar a tabela atual a qualquer receptor que faça a solicitação;
e cadastra novos receptores de acordo com a requisição e a disponibilidade.
Todas os tratamentos do servidor a requisições são feitos em {\it Threads} separadas que compartilham a tabela de receptores,
a Figura \ref{fig:Servidor} apresenta sua máquina de estados.

\begin{figure}%[ht]
	\centering
	\includegraphics[width=1\textwidth]{images/Protocolo_Cliente_Emissor.pdf}
	\caption{Máquina de estados do Cliente Emissor.}
	\label{fig:Emissor}
\end{figure}

\begin{figure}%[ht]
	\centering
	\includegraphics[width=1\textwidth]{images/Protocolo_Cliente_Receptor.pdf}
	\caption{Máquina de estados do Cliente Receptor.}
	\label{fig:Receptor}
\end{figure}

\begin{figure}%[ht]
	\centering
	\includegraphics[width=1\textwidth]{images/Protocolo_Servidor.pdf}
	\caption{Máquina de estados do Cliente Receptor.}
	\label{fig:Servidor}
\end{figure}

%%=========================================================================================
\section{Mensagens}\label{sec:Mensagens}
%%=========================================================================================

O protocolo define três tipos de mensagens,
{\tt Notificação}, {\tt Listagem} e {\tt Registro}.
Cada grupo de mensagens são usadas dentro de um mesmo contexto e compartilham o padrão de cabeçalho,
todo cabeçalho começa com um cabo de {\bf Código} de 1 bytes usado para identificar o tipo da mensagem.
Também é padronizado o tamanho dos "nomes" utilizados nos corpos das mensagens,
sendo estes uma sequência de 16 caracteres de 8 bits (16 bytes no total).

Mensagens do tipo {\tt Notificação} representam o principal tipo de mensagens enviadas no sistema.
Elas possuem um cabeçalho de 16 bits e corpo variável:
\begin{itemize}
\item Cabeçalho:
	\begin{itemize}
	\item {\bf Código} - 1 byte.
	\item {\bf Código Receptor} - 11 bytes.
	\item {\bf Timestamp} - 4 bytes.
	\end{itemize}
\item Corpo:
	\begin{itemize}
	\item {\bf Nome do Emissor} - 16 byte.
	\item {\bf Texto} - Variável.
	\end{itemize}
\end{itemize}
O campo {\bf Código} representa o tipo da mensagem e deve sempre conter 078 (ASCII correspondente à 'N').
{\bf Código Remente} é o identificar do remente da notificação no servidor,
cada servidor pode então indexar até 2048 receptores.
{\bf Timestamp} é o horário de envio da notificação no padrão Unix.
O corpo da mensagem deve, por fim, começar com o {\bf Nome do Emissor} seguido então pelo {\bf Texto} da notificação.

Mensagens do tipo {\tt Listagem} são usadas para informar emissores dos receptores disponíveis.
Possuem cabeçalho de 12 bits e dois subtipos:
{\tt Solicitação}, que são enviadas por emissores;
e {\tt Resposta}, enviada por servidores.
Mensagens de {\tt Listagem} tem a seguinte organização:
\begin{itemize}
\item Cabeçalho:
	\begin{itemize}
	\item {\bf Código} - 1 byte.
	\item {\bf Número de usuários} - 11 bytes.
	\end{itemize}
\item Corpo em {\tt Solicitação}:
	\begin{itemize}
	\item {\bf Nome Emissor} - 16 bytes.
	\end{itemize}
\item Corpo em {\tt Resposta}:
	\begin{itemize}
	\item {\bf Lista de usuários} (Código e nome) - 27 bytes por par.
	\end{itemize}
\end{itemize}
O campo {\bf Código} deve sempre conter 076 (ASCII correspondente à 'L').
Na {\tt Solicitação}, o {\bf Número de usuários} contém o número máximo de usuários que se deseja receber;
já {\tt Resposta}, o campo contém o número de usuários retornados na mensagem.

Mensagens de {\tt Registro} são usados no início de uma nova conexão de um receptor.
Estes cabeçalhos possuem 12 bits e três subtipos:
{\tt Solicitação}, {\tt Confirmação} e {\tt Desconexão}.
\begin{itemize}
\item Cabeçalho:
	\begin{itemize}
	\item {\bf Código} - 1 byte.
	\item {\bf Código Receptor} - 11 bytes.
	\end{itemize}
\item Corpo em {\tt Confirmação}:
	\begin{itemize}
	\item {\bf Retorno} - 1 bytes.
	\end{itemize}
\end{itemize}
O campo {\bf Código} deve conter 082 em mensagens de {\tt Solicitação} e {\tt Confirmação},
ou 068 em mensagens de {\tt Desconexão} (ASCII correspondente à `R' e `D' respectivamente).
Na {\tt Solicitação} o campo {\bf Código Receptor} é usado como índice preferível,
e na {\tt Confirmação} o índice ao qual o Receptor foi alocado é informado no {\bf Código Receptor},
ambas mensagens de {\tt Solicitação} e {\tt Confirmação} não possuem corpo, apenas o cabeçalho.
O campo {\bf Retorno} na {\tt Confirmação} contem 0 caso a conexão seja bem sucedida, ou um valor de erro caso contrário.
{\bf Retorno} pode assumir os seguintes valores:
\begin{itemize}
\item 0 - Conexão bem sucedida no endereço requirido.
\item 1 - Conexão bem sucedida no endereço retornado em {\bf Código Receptor}
\item 2 - Conexão recusada, servidor cheio.
\item 4 - Conexão recusada, servidor lista negra.
\item 128 - Erro não informado.
\end{itemize}

%%=========================================================================================
\section{Conclusão}\label{sec:Conclusao}
%%=========================================================================================

O Sistema Simples de Notificação Remota é um protocolo de notificações distribuídas que
permite uma implementação simples de clientes,
especializando-os nas funções de emissor ou receptor.
Aplicações que disponham de mais robustez podem implementar ambos os protocolos de cliente se assim desejarem.

Para um exemplo de uso deste protocolo então propomos três aplicações diferentes:
(1) O Servidor, de uso como descrito no protocolo.
(2) Uma aplicação de terminal para {\it Desktops} que pode enviar notificações.
(3) E um aplicativo para Celular que apenas recebe notificações.
Tomando como cenário então vários {\it Desktops} que possuem a implementação mencionada
e que computam programas que levam tempo arbitrário para terminar.
É possível então, com um pouco de habilidade em {\it Shell Script},
fazer com que sempre que um programa terminar a execução,
uma notificação seja enviada para o Celular com tal aplicativo indicando:
a máquina que enviou a notificação (no campo {\bf Nome Emissor} da Notificação),
e parte da saída padrão ou saída de erro do programa (no campo {\bf Texto}).

\end{document}
